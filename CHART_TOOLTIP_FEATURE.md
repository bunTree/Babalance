# 成长曲线图坐标提示功能

## 🎯 功能概述

成长曲线图现在支持触摸交互，当用户触摸或移动手指在图表上时，会显示一个智能提示框，展示当前光标位置对应的详细坐标信息。

## ✨ 核心特性

### 1. 实时坐标显示
- **触摸响应**：支持 `touchstart`、`touchmove`、`touchend` 事件
- **精确定位**：根据触摸位置计算对应的时间点和数值
- **智能提示**：自动显示最相关的数据信息

### 2. 丰富的信息展示
- **年龄信息**：显示对应时间点的宝宝年龄（如"6个月"、"1岁3个月"）
- **实际测量值**：如果该时间点有实际记录，显示具体数值
- **WHO百分位数据**：显示所有WHO标准曲线的对应值
  - P3 (3%)：第3百分位
  - P15 (15%)：第15百分位
  - P50 (50%)：第50百分位（中位数）
  - P85 (85%)：第85百分位
  - P97 (97%)：第97百分位

### 3. 智能交互体验
- **即时显示**：触摸时立即显示提示框
- **跟随移动**：手指移动时提示框实时跟随
- **延迟隐藏**：触摸结束后延迟1秒隐藏，方便用户查看
- **边界检测**：只在图表有效区域内显示提示

## 🎨 视觉设计

### 提示框样式
- **半透明背景**：黑色背景，85%透明度
- **圆角设计**：8rpx圆角，现代化外观
- **阴影效果**：柔和阴影，增强层次感
- **箭头指示**：底部三角形箭头指向触摸点

### 性别主题适配
- **男宝主题**：蓝色系提示框（rgba(79, 172, 254, 0.9)）
- **女宝主题**：粉色系提示框（rgba(255, 107, 157, 0.9)）
- **默认主题**：深色提示框

### 动画效果
- **淡入动画**：0.2秒缓动出现
- **缩放效果**：从0.8倍缩放到1倍
- **平滑过渡**：所有状态变化都有过渡动画

## 🔧 技术实现

### 坐标计算算法
```javascript
// 计算X轴位置对应的数据点索引
const relativeX = canvasX - padding
const dataIndex = Math.round((relativeX / chartWidth) * (currentData.values.length - 1))
const clampedIndex = Math.max(0, Math.min(dataIndex, currentData.values.length - 1))

// 计算Y轴对应的数值
const relativeY = canvasY - padding
const yValue = maxValue - (relativeY / chartHeight) * (maxValue - minValue)
```

### 年龄计算逻辑
```javascript
calculateAgeFromTimeLabel(timeLabel) {
  // 支持多种时间格式
  // "2024-01" 格式 -> 解析为具体日期
  // "1月" 格式 -> 结合生日年份计算
  
  const ageInMonths = this.calculateAgeInMonths(birthDate, targetDate)
  
  if (ageInMonths < 12) {
    return `${ageInMonths}个月`
  } else {
    const years = Math.floor(ageInMonths / 12)
    const months = ageInMonths % 12
    return months === 0 ? `${years}岁` : `${years}岁${months}个月`
  }
}
```

### 事件处理流程
1. **触摸开始** (`onChartTouchStart`)
   - 记录触摸位置
   - 调用坐标计算函数

2. **触摸移动** (`onChartTouchMove`)
   - 实时更新触摸位置
   - 重新计算并更新提示框

3. **触摸结束** (`onChartTouchEnd`)
   - 延迟1秒后隐藏提示框
   - 给用户充分时间查看信息

## 📊 数据展示示例

### 有实际测量数据时
```
6个月
年龄: 6个月
实际值: 8.0kg
WHO P3 (3%): 6.2kg
WHO P15 (15%): 7.0kg
WHO P50 (50%): 7.9kg
WHO P85 (85%): 8.9kg
WHO P97 (97%): 10.0kg
```

### 无实际测量数据时
```
3个月
年龄: 3个月
坐标值: 7.2kg
WHO P3 (3%): 5.8kg
WHO P15 (15%): 6.5kg
WHO P50 (50%): 7.4kg
WHO P85 (85%): 8.3kg
WHO P97 (97%): 9.4kg
```

## 🧪 测试功能

### 测试按钮
- **按钮名称**：📍 测试坐标提示
- **测试内容**：显示模拟的提示框，展示完整的数据格式
- **测试时长**：3秒自动隐藏

### 测试数据
```javascript
tooltipValues: [
  '年龄: 6个月',
  '实际值: 8.0kg',
  'WHO P3 (3%): 6.2kg',
  'WHO P15 (15%): 7.0kg',
  'WHO P50 (50%): 7.9kg',
  'WHO P85 (85%): 8.9kg',
  'WHO P97 (97%): 10.0kg'
]
```

## 🎯 使用场景

### 1. 精确数据查看
- 用户想了解特定时间点的WHO标准值
- 对比实际测量值与标准值的差异
- 查看宝宝在不同百分位的位置

### 2. 趋势分析
- 观察成长曲线的变化趋势
- 识别异常的增长模式
- 评估发育是否正常

### 3. 医学参考
- 为医生就诊提供准确数据
- 记录关键时间点的发育指标
- 制定个性化的成长计划

## 🔄 未来优化方向

### 1. 功能增强
- [ ] 支持多点触摸对比
- [ ] 添加数据导出功能
- [ ] 集成语音播报
- [ ] 支持手势缩放

### 2. 交互优化
- [ ] 添加震动反馈
- [ ] 优化触摸灵敏度
- [ ] 支持长按固定提示框
- [ ] 添加快捷操作菜单

### 3. 数据扩展
- [ ] 显示同龄宝宝对比
- [ ] 添加发育里程碑提醒
- [ ] 集成营养建议
- [ ] 提供个性化分析报告

## 📱 兼容性说明

- **微信小程序**：完全支持
- **触摸设备**：优化体验
- **不同屏幕尺寸**：自适应布局
- **性能要求**：轻量级实现，流畅运行

---

*此功能为成长曲线图的重要交互增强，大大提升了用户查看和分析宝宝成长数据的便利性。* 