# WHO成长曲线百分位数系统实现

## 📊 功能概述

本项目已成功升级为WHO（世界卫生组织）儿童成长曲线百分位数系统，提供更精确、更专业的宝宝发育评估。**特别专注于0-1岁婴儿期的成长监测**，这是宝宝发育最关键的时期。

## 🎯 核心特性

### 1. 百分位数评估系统
- **P3（第3百分位）**：只有3%的同龄儿童低于此值，可能需要关注
- **P15（第15百分位）**：15%的同龄儿童低于此值，略低于平均水平
- **P50（第50百分位）**：中位数，50%的同龄儿童低于此值，代表平均水平
- **P85（第85百分位）**：85%的同龄儿童低于此值，略高于平均水平
- **P97（第97百分位）**：97%的同龄儿童低于此值，可能需要关注

### 2. 性别区分标准
- **男宝宝标准**：使用WHO男童成长曲线百分位数据
- **女宝宝标准**：使用WHO女童成长曲线百分位数据
- **自动识别**：根据宝宝性别信息自动选择对应标准

### 3. 年龄精确计算
- **月龄计算**：精确计算宝宝在每个测量时点的月龄
- **动态百分位**：根据不同月龄提供对应的WHO百分位值
- **范围覆盖**：支持0-60个月（0-5岁）的完整成长周期
- **婴儿期重点**：特别优化0-12个月的数据展示和分析

### 4. 三项指标支持
- **体重百分位**：WHO体重-年龄百分位曲线
- **身高百分位**：WHO身高-年龄百分位曲线  
- **头围百分位**：WHO头围-年龄百分位曲线

## 🔧 技术实现

### 数据结构
```javascript
getWHOPercentiles() {
  return {
    male: {
      weight: {
        P3: [2.5, 3.4, 4.4, ...],   // 第3百分位体重值
        P15: [2.9, 3.9, 4.9, ...],  // 第15百分位体重值
        P50: [3.3, 4.5, 5.6, ...],  // 第50百分位体重值（中位数）
        P85: [3.8, 5.1, 6.4, ...],  // 第85百分位体重值
        P97: [4.4, 5.8, 7.1, ...]   // 第97百分位体重值
      },
      height: { P3: [...], P15: [...], P50: [...], P85: [...], P97: [...] },
      head: { P3: [...], P15: [...], P50: [...], P85: [...], P97: [...] }
    },
    female: {
      // 女宝宝对应的百分位数据结构相同
    }
  }
}
```

### 核心算法
```javascript
// 获取WHO百分位值
getWHOPercentileValue(type, ageInMonths, percentile = 'P50', gender) {
  // 1. 性别标准化
  const whoGender = gender === 'boy' ? 'male' : 'female'
  
  // 2. 获取对应性别的百分位数据
  const genderPercentiles = this.getWHOPercentiles()[whoGender]
  
  // 3. 根据月龄索引获取百分位值
  const monthIndex = Math.max(0, Math.min(60, Math.floor(ageInMonths)))
  return genderPercentiles[type][percentile][monthIndex]
}

// 计算宝宝在同龄群体中的位置
calculatePercentilePosition(actualValue, type, ageInMonths, gender) {
  const percentiles = ['P3', 'P15', 'P50', 'P85', 'P97']
  const values = percentiles.map(p => 
    this.getWHOPercentileValue(type, ageInMonths, p, gender)
  )
  
  // 判断实际值在哪个百分位区间
  if (actualValue <= values[0]) {
    return { percentile: '<P3', description: '低于第3百分位', level: 'low' }
  } else if (actualValue <= values[1]) {
    return { percentile: 'P3-P15', description: '第3-15百分位', level: 'below-average' }
  }
  // ... 其他区间判断
}
```

### 月龄计算
```javascript
// 精确计算记录时的月龄
calculateRecordAge(birthday, recordDate) {
  const birthDate = new Date(birthday)
  const recordDate = new Date(recordDate)
  
  let months = (recordDate.getFullYear() - birthDate.getFullYear()) * 12
  months += recordDate.getMonth() - birthDate.getMonth()
  
  if (recordDate.getDate() < birthDate.getDate()) {
    months--
  }
  
  return Math.max(0, months)
}
```

## 📈 图表显示

### 视觉特性
- **实线（蓝色）**：显示宝宝实际测量值，带数据点
- **P50线（绿色实线）**：中位数线，代表平均水平
- **P85/P15线（蓝色虚线）**：上下四分位线
- **P97/P3线（紫色短虚线）**：极值线，超出需关注
- **彩色图例**：清晰标注各百分位线含义

### 百分位线颜色系统
```javascript
const percentileColors = {
  P3: '#ff6b6b',   // 红色 - 第3百分位
  P15: '#ffa726',  // 橙色 - 第15百分位
  P50: '#66bb6a',  // 绿色 - 第50百分位（中位数）
  P85: '#42a5f5',  // 蓝色 - 第85百分位
  P97: '#ab47bc'   // 紫色 - 第97百分位
}
```

### 动态更新
- 切换指标类型时自动更新对应的WHO百分位曲线
- 根据宝宝性别自动调整百分位值和图例显示
- 时间范围筛选时重新计算各时点的百分位值

## 🎨 用户体验

### 智能评估
- 自动计算宝宝在同龄群体中的相对位置
- 提供百分位区间描述（如"第50-85百分位"）
- 根据百分位位置给出发育水平评价

### 科学对比
- 每个测量点都有完整的百分位参考范围
- 可直观看出宝宝发育在人群中的位置
- 支持长期趋势和百分位轨迹分析

### 专业可信
- 采用WHO官方发布的百分位数据
- 全球通用的儿童发育评估标准
- 医学专业认可的参考依据

## 📊 百分位数解读

### 正常范围
- **P15-P85**：大多数健康儿童的发育范围
- **P25-P75**：中等发育水平范围
- **P50**：平均发育水平

### 需要关注
- **<P3 或 >P97**：可能需要医学评估
- **持续偏离轨迹**：需要关注发育趋势
- **跨越多个百分位**：可能的发育变化

### 使用建议
1. **不要过度焦虑**：百分位只是参考，每个孩子都有自己的发育节奏
2. **关注趋势**：比单次测量更重要的是长期发育轨迹
3. **综合评估**：结合多项指标和实际情况
4. **专业咨询**：有疑问时咨询儿科医生

## 📋 数据来源

本实现基于WHO官方发布的儿童成长标准：
- WHO Child Growth Standards (2006)
- 涵盖0-60个月儿童的体重、身高、头围百分位数据
- 区分男女性别的不同成长模式
- 基于全球多国儿童的大样本数据

## 🔄 更新维护

### 数据准确性
- 所有百分位值均来自WHO官方数据
- 定期核对确保数据准确性
- 支持未来标准更新的扩展

### 性能优化
- 百分位数据预加载，无需网络请求
- 高效的月龄索引算法
- 最小化计算开销

## 🎯 使用效果

用户现在可以：
1. **精确评估**：基于WHO百分位系统评估宝宝发育状况
2. **相对位置**：了解宝宝在同龄群体中的发育位置
3. **趋势监控**：跟踪宝宝的百分位轨迹变化
4. **科学参考**：获得更细致的发育评估信息
5. **专业可信**：使用国际权威的医学百分位标准
6. **婴儿期专注**：重点展示0-1岁关键发育期的详细数据

## 🍼 0-1岁婴儿期重点监测

### 为什么专注0-1岁？
- **快速发育期**：婴儿期是人生中发育最快的阶段
- **关键指标**：体重、身高、头围变化最为显著
- **早期干预**：及时发现发育异常，便于早期干预
- **家长关注**：新手父母最关心的成长阶段

### 测试数据优化
- **WHO P50数据**：覆盖0-12个月，每月一条记录（13条）
- **多样化数据**：包含不同成长模式的0-14个月数据（15条）
- **本地测试**：快速生成0-12个月的完整测试数据（13条）

这一升级大大提升了成长监测的专业性和精确度，特别是对婴儿期成长的精细化监测，为家长提供了更科学、更详细的宝宝发育评估工具。 