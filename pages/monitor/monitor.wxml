<!--æ•°æ®æŸ¥çœ‹é¡µé¢-->
<view class="container {{backgroundClass}}">
  <!-- çŠ¶æ€æ å ä½ -->
  <view class="status-bar" style="height: {{statusBarHeight}}px;"></view>

  <!-- ä¸»å¡ç‰‡å®¹å™¨ -->
  <view class="main-card">
    <!-- é¡¶éƒ¨æŒ‡æ ‡æ¦‚è§ˆ -->
    <view class="metrics-section {{backgroundClass}}">
      <view class="metrics-title">æœ€æ–°æ•°æ®</view>
      <view class="metrics-grid">
        <view class="metric-item" wx:for="{{metrics}}" wx:key="key">
          <view class="metric-icon">{{item.icon}}</view>
          <view class="metric-value">{{item.value}}</view>
          <view class="metric-label">{{item.label}}</view>
          <view class="metric-unit">{{item.unit}}</view>
        </view>
      </view>
      <view class="metrics-date">æœ€åæ›´æ–°ï¼š{{lastUpdateDate}}</view>
    </view>

    <!-- å›¾è¡¨åŒºåŸŸ -->
    <view class="chart-section">
      <view class="section-header">
        <view class="section-title">æˆé•¿æ›²çº¿</view>
        <view class="chart-type-tabs">
          <view 
            class="chart-tab {{item.active ? 'active' : ''}}"
            wx:for="{{chartTypes}}" 
            wx:key="key"
            bindtap="onChartTypeChange"
            data-type="{{item.key}}"
          >
            {{item.label}}
          </view>
        </view>
      </view>

      <!-- æ—¶é—´èŒƒå›´é€‰æ‹© -->
      <view class="time-selector">
        <view 
          class="time-btn {{item.active ? 'active' : ''}}" 
          wx:for="{{timeOptions}}" 
          wx:key="key"
          bindtap="onTimeChange" 
          data-period="{{item.key}}"
        >
          {{item.label}}
        </view>
      </view>

      <!-- å›¾è¡¨ç”»å¸ƒ -->
      <view class="chart-container">
        <canvas 
          canvas-id="growthChart" 
          class="chart-canvas"
          bindtouchstart="touchChart"
          bindtouchmove="touchChart"
        ></canvas>
      </view>
    </view>

    <!-- æ™ºèƒ½åˆ†æ -->
    <view class="analysis-section">
      <view class="section-header">
        <view class="section-icon">ğŸ’¡</view>
        <view class="section-title">æ™ºèƒ½åˆ†æ</view>
      </view>
      <view class="analysis-content">{{analysisText}}</view>
    </view>

    <!-- å†å²è®°å½• -->
    <view class="history-section">
      <view class="section-header">
        <view class="section-icon">ğŸ“‹</view>
        <view class="section-title">å†å²è®°å½•</view>
        <view class="section-action" bindtap="viewAllRecords">æŸ¥çœ‹å…¨éƒ¨</view>
      </view>
      <view class="records-list">
        <view class="record-card" wx:for="{{recentRecords}}" wx:key="id">
          <view class="record-date">{{item.date}}</view>
          <view class="record-measurements">
            <view class="measurement-item" wx:for="{{item.measurements}}" wx:for-item="measurement" wx:key="type">
              <text class="measurement-label">{{measurement.label}}:</text>
              <text class="measurement-value">{{measurement.value}} {{measurement.unit}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{recentRecords.length === 0}}">
        <view class="empty-icon">ğŸ“Š</view>
        <view class="empty-title">æš‚æ— è®°å½•</view>
        <view class="empty-subtitle">ç‚¹å‡»ä¸‹æ–¹åŠ å·æŒ‰é’®å¼€å§‹è®°å½•å®å®çš„æˆé•¿æ•°æ®</view>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ è®°å½•å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showModal}}" bindtap="hideModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-body">
        <view class="form-group">
          <text class="form-label">èº«é«˜ (cm)</text>
          <input 
            class="form-input" 
            type="number" 
            placeholder="ä¾‹å¦‚ï¼š68.5" 
            value="{{modalData.height}}"
            bindinput="onModalInput"
            data-field="height"
            maxlength="5"
          />
        </view>

        <view class="form-group">
          <text class="form-label">ä½“é‡ (kg)</text>
          <input 
            class="form-input" 
            type="number" 
            placeholder="ä¾‹å¦‚ï¼š8.5" 
            value="{{modalData.weight}}"
            bindinput="onModalInput"
            data-field="weight"
            maxlength="5"
          />
        </view>

        <view class="form-group">
          <text class="form-label">å¤´å›´ (cm)</text>
          <input 
            class="form-input" 
            type="number" 
            placeholder="ä¾‹å¦‚ï¼š42.5" 
            value="{{modalData.head}}"
            bindinput="onModalInput"
            data-field="head"
            maxlength="5"
          />
        </view>

        <view class="form-group">
          <text class="form-label">è®°å½•æ—¥æœŸ</text>
          <picker mode="date" value="{{modalData.date}}" bindchange="onModalDateChange">
            <view class="form-input picker-input">
              <text class="picker-text">{{modalData.date || 'ç‚¹å‡»é€‰æ‹©æ—¥æœŸ'}}</text>
              <text class="picker-arrow">ğŸ“…</text>
            </view>
          </picker>
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn btn-cancel" bindtap="hideModal">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="submitRecord" disabled="{{submitting}}">
          {{submitting ? 'ä¿å­˜ä¸­...' : 'ç¡®å®š'}}
        </button>
      </view>
    </view>
  </view>
</view> 